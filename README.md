# Context

This project is created to demonstrate how we can use HK2 framework to resolve dependency injection.

Usually, as of today, there is very limited HK2 documentation available in Internet. Latest and most useful documentation site is https://javaee.github.io/hk2/ , however this is also not continuously maintained and updated. Not quite good too for first time learner.

Thus, I am trying to document my experience with HK2, so developers who want to learn HK2 dependency container can quickly pick up and start using it without much hick up :) Note, it is still in-progress DRAFT documentation, will be updated as we progress. 

### What do we need to kick start with HK2 ?

* Any IDE else command line build tool is also okay, I am using Intellij
* Familiarity with Maven or Gradle or any other Build system. I am using Gradle here.
* Of course familiarity with Java.. Am I kidding ;)

##### Step 1: get the dependencies
Now, create either Maven or Gradle project in Intellij. If you have created a Maven project then please add following dependencies in pom.xml and if you choose Gradle then add below dependencies in build.gradle file under project root directory.

##### pom.xml for Maven
 
        <properties>
                <hk2.version>2.5.0</hk2.version>
        </properties> 
        <dependency>
             <groupId>org.glassfish.hk2</groupId>
             <artifactId>hk2-api</artifactId>
             <version>${hk2.version}</version>
         </dependency>
         <dependency>
             <groupId>org.glassfish.hk2</groupId>
             <artifactId>hk2-locator</artifactId>
             <version>${hk2.version}</version>
         </dependency>
         <dependency>
             <groupId>org.glassfish.hk2</groupId>
             <artifactId>hk2-metadata-generator</artifactId>
             <version>${hk2.version}</version>
             <scope>provided</scope>
         </dependency>

##### build.gradle for Gradle

        dependencies {
            compile group: 'org.glassfish.hk2', name: 'hk2-api', version:'2.5.0'
            compile group: 'org.glassfish.hk2', name: 'hk2-locator', version:'2.5.0'
            compileOnly group: 'org.glassfish.hk2', name: 'hk2-metadata-generator', version:'2.5.0'
        }

##### Step 2: Create required Classes and Annotate

Go through all the below classes and its documentation to have better understanding about HK2 APIs and Annotation 

        TestDemo -          This is a test class to trigger the DemoService via HK2 Dependency Injection framework.
        DemoService -       Annotated with @Service. This class represents a Service containing multiple APIs (methods) for external consumptions. This is a Service class as per HK2 framework and can be injected as and when required by external caller. 
        DemoContract -      Annotated with @Contract.This is an Interface of possible Services which will expose defined public APIs (methods) for client consumptions. As per HK2 framework, Services can be injected as and when necessary.
        Vehicle -           Annotated with @Contract. This is a Business Interface and declaring as Contract as per HK2 framework for identifying it as Interface of Injectable Business Objects.
        Bike -              Annotated with @Service. This class is an implementation of Vehicle interface but with characteristics of a Bike.
        Car -               Annotated with @Service. This class is an implementation of Vehicle interface but with characteristics of a Car.
        MovementStatus -    This is an Enum class defining possible movement patterns which are constants.           

##### Step 3: Create inhabitant file 
Inhabitant file contains all Service Definitions that HK2 Dependency container scans and loads all related objects. There are three way of creating these entries. 

1. Manually. LOL ;)
2. Using inhabitant file generator tool provided by HK2 
3. Best one : Using Maven or Gradle plugin. We already added the hk2-metadata-generator plugin in Maven or Gradle dependencies.

Third option is easy & simplest, hence not discussuing about first two options here. Gradle or Maven plugin will take care of inhabitant file generation as soon as you trigger fresh build. Though, there is a glitch/bug , hence you may need to sometime fo a clean build if you see weird Exceptions which are basically due to incomplete inhabitant file.   

###### Sample inhabitant file content:

        #
        # Generated by hk2-metadata-generator
        #
        
        [in.dhrubo.demo.bo.Bike]S
        contract={in.dhrubo.demo.bointerface.Vehicle}
        name=Bike
        qualifier={javax.inject.Named}
        
        [in.dhrubo.demo.bo.Car]S
        contract={in.dhrubo.demo.bointerface.Vehicle}
        name=Car
        qualifier={javax.inject.Named}
        
        [in.dhrubo.demo.service.DemoService]S
        contract={in.dhrubo.demo.contract.DemoContract}

##### Step 4: run the program

TADA ! just run TestDemo java main class either from Intellij or running Maven/Gradle command line.

###### Gradle : 
There are many ways, but simplest option is to add following lines in build.gradle

        apply plugin: 'application'
        mainClassName = "in.dhrubo.demo.TestDemo"
         
Gradle command to run the application : 

        gralde clean
        gradle build
        gradle run

###### Maven :

        mvn clean install
        mvn compile
        mvn exec:java -Dexec.mainClass="in.dhrubo.demo.TestDemo"

##### Concept: Terminology & Design walk-through [ In Progress ]

We have successfully run the program and now lets deep dive into concept and workflow around how HK2 works.

@Contract -   
@Service -   
@Named -  
@Singleton -  
@Rank -  
@Stub -  

Service Descriptor -   
Binder -   

###### How HK2 Loads [ In Progress ]

1. via Service Locator and inhabitant file
2. via implementing and registering AbstractBinder

There are many more topic in HK2 , but I like to limit this for now and will be including others as and when required or requested by readers. Please feel free to provide your opinion in comment section. I will take action accordingly.

##### DEBUGGING Observations:

- While adding multiple implementation of a Contract >> Locator is unable to returning service . Requires clean build as inhabitant files recreated without all Service definitions.

- Refactoring class name requires clean build to regenerate service definition in inhabitant file

- Sometimes, inhabitant file gets overwritten after running the application from Intillij and this forces us to do a clean build once again.

##### Personal Opinion:
 
My experience with HK2 is not as expected and I suggest you take special care while debugging. You may face unwanted exceptions that you would not foresee. It is not 100% reliable and seems unstable to me while generating inhabitant definition and as well as injecting objects. There are limitations that you need to be aware of. It requires fresh clean build every time if you make any injection related changes including refactoring of Java classes, which is to some extent logical if you change Contract & Service name. However, simply running the program may overwrite inhabitant file which could be problem with maven hk2-metadata-generator dependency module or IntelliJ (which I don't think). 

There are other Dependency Injection framework available in market , you may want to try with e.g. Java EE6 CDI ,Guice , Dagger, Pico  If your design choice is not limited with only DI, you can also try OSGi, Spring etc.

  
